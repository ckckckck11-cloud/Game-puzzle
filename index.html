<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬è³£å±€æ•¸å­—æ‹¼åœ–éŠæˆ² (æ¹¯è‘£è…¹è‚Œæœ‰å…«å¡Š)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Noto Sans CJK TC ä½œç‚ºä¸»è¦å­—é«” */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f7f9fc;
        }
        .puzzle-cell {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.2s, border-color 0.2s, transform 0.1s;
            cursor: pointer;
            user-select: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin: 1px;
            border: 2px solid #e5e7eb; /* é è¨­é‚Šæ¡† */
            background-color: #f3f4f6;
            color: #1f2937;
        }
        /* å·²é¸å–è·¯å¾‘çš„æ¨£å¼ (æ‹–æ›³æ™‚çš„é è¦½ - çŸ©å½¢æ¨¡å¼) */
        .selected-path {
            /* ä½¿ç”¨ä¸€å€‹çªå‡ºçš„é¡è‰²ä¾†è¡¨ç¤ºçŸ©å½¢é¸å€ */
            border-color: #1d4ed8 !important; /* Tailwind blue-700 */
            background-color: #bfdbfe !important; /* Tailwind blue-200 */
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.12);
        }
        
        /* --- æ ¹æ“šä½¿ç”¨è€…è¦æ±‚å®šåˆ¶çš„é¡è‰²é‚è¼¯ (ç”¨æ–¼è‡ªå‹•æ±‚è§£å™¨é«˜äº®) --- */
        
        /* 1+9: ç´…è‰² (æœ€é«˜å„ªå…ˆç´š) */
        .highlight-19 { 
            background-color: #f87171 !important; /* Tailwind red-400 */
            border-color: #ef4444 !important; /* Tailwind red-500 */
            color: white;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* 2+8: ç¶ è‰² */
        .highlight-28 { 
            background-color: #4ade80 !important; /* Tailwind green-400 */
            border-color: #22c55e !important; /* Tailwind green-500 */
            color: #1f2937;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* 3+7: é»ƒè‰² */
        .highlight-37 { 
            background-color: #fcd34d !important; /* Tailwind yellow-300 */
            border-color: #f59e0b !important; /* Tailwind yellow-500 */
            color: #1f2937;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* 4+6: è—è‰² */
        .highlight-46 { 
            background-color: #60a5fa !important; /* Tailwind blue-400 */
            border-color: #3b82f6 !important; /* Tailwind blue-500 */
            color: white;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* 5+5: ç²‰ç´…è‰²/ç«ç‘°ç´… */
        .highlight-55 { 
            background-color: #f472b6 !important; /* Tailwind rose-400 */
            border-color: #ec4899 !important; /* Tailwind rose-500 */
            color: white;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* å¤šä½æ•¸çµ„åˆ (å…¶ä»–ç›¸åŠ ç­‰æ–¼ 10 çš„çµ„åˆ): ç´«è‰² */
        .highlight-multi {
            background-color: #a78bfa !important; /* Tailwind violet-400 */
            border-color: #8b5cf6 !important; /* Tailwind violet-500 */
            color: white;
            animation: pulse-highlight 1.5s infinite alternate;
        }
        /* é è¨­çš„éé«˜äº®æ¨£å¼ (æ·±ç°è‰²) */
        .default-cell {
             background-color: #e5e7eb !important; /* Gray 200 */
             color: #4b5563 !important; /* Gray 600 */
             border-color: #d1d5db !important; /* Gray 300 */
        }
        /* å·²æ¶ˆé™¤çš„å–®å…ƒæ ¼ */
        .cleared-cell {
            background-color: #e0f2f1 !important; /* Teal 50 - æ¨¡æ“¬ç©ºç™½ */
            border-color: #e0f2f1 !important;
            color: #ccc;
            opacity: 0.6;
            cursor: default;
        }

        #puzzle-grid { 
            display: inline-block; /* ä»¥ inline-block åŒ…å«å¤šè¡Œ flex-row */
        }

        @keyframes pulse-highlight {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.05); opacity: 0.9; }
        }
    </style>
</head>
<body class="p-8">

    <!-- ========================================================= -->
    <!-- é€™è£¡æ”¾ç½®æ‰€æœ‰éŸ³æ•ˆçš„ HTML5 å…ƒç´  -->
    <!-- ========================================================= -->
    <audio id="sound1" data-sound-name="æ­£äº‹ä¸å¹¹å°ˆæé€™ç¨®é³¥æ˜¯" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/922ac5e53bf90b55f7276cdfcd886404.mp3"></audio>
    <audio id="sound2" data-sound-name="æˆ‘å·²ç¶“å¾ˆèˆˆå¥®äº†" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/9daeb8f3b2bc1568858dfdac95d977ed.mp3"></audio>
    <audio id="sound3" data-sound-name="å°±æ˜¯é€™éº¼ç°¡å–®" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/4b3591e8d14ec853d7f7ad47b671292a.mp3"></audio>
    <audio id="sound4" data-sound-name="ä¸Šå¸å°±è¦é™è‡¨å•¦" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/a7bce6b8ac4c61c18514027e4f936ad1.mp3"></audio>
    <audio id="sound5" data-sound-name="è¦‹è­‰äº†ç¥è¹Ÿå•¦" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/2b005a77613ba7e69d64a069fce89349.mp3"></audio>
    <audio id="sound6" data-sound-name="ç¥å¨è“‹ä¸–" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/70e3723450c414c489ad7beab498e725.mp3"></audio>
    <audio id="clear-sound" src="https://memeprod.sgp1.digitaloceanspaces.com/user-sound/922ac5e53bf90b55f7276cdfcd886404.mp3"></audio>


<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-2">å…¬è³£å±€æ•¸å­—æ‹¼åœ–éŠæˆ² (æ¹¯è‘£è…¹è‚Œæœ‰å…«å¡Š)</h1>
    <p class="text-gray-500 mb-6 font-semibold">
        ***æ‰‹å‹•æ“ä½œæ–°è¦å‰‡***ï¼šè«‹ä½¿ç”¨æ»‘é¼ æˆ–è§¸æ§æ‹–æ›³ä¾†é¸å–**çŸ©å½¢å€åŸŸ**ã€‚çŸ©å½¢å…§æ‰€æœ‰**éç©ºæ•¸å­—**çš„ç¸½å’Œå¿…é ˆç‚º **10** æ‰èƒ½æ¶ˆé™¤ï¼
    </p>

    <!-- ========================================================= -->
    <!-- ã€ä¿®æ”¹é» 2ã€‘æ’è¡Œæ¦œä½ç½®ç§»åˆ°æœ€ä¸Šæ–¹ -->
    <!-- ========================================================= -->
    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-6">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">ğŸ† æ’è¡Œæ¦œ </h2>
        <ul id="leaderboard" class="text-gray-700 text-sm space-y-1"></ul>
    </div>
    <!-- ========================================================= -->


    <div class="grid lg:grid-cols-3 gap-8">
        <!-- æ‹¼åœ–é¡¯ç¤ºå€ -->
        <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">ğŸ§© æ‹¼åœ–ç¶²æ ¼ (æ‹–æ›³èµ·é»å’Œçµ‚é»ä¾†æ¡†é¸çŸ©å½¢å€åŸŸ)</h2>
            <div id="puzzle-grid" class="flex flex-col items-start justify-center">
                <!-- Grid will be rendered here -->
            </div>
            <p id="click-feedback" class="mt-4 text-center font-medium text-lg text-blue-600">è«‹æ‹–æ›³é¸å–èµ·é»å’Œçµ‚é»ï¼Œå®šç¾©çŸ©å½¢å€åŸŸã€‚</p>
        </div>

        <!-- æ§åˆ¶èˆ‡çµæœå€ -->
        <div class="lg:col-span-1 space-y-6">
            <!-- æ•¸æ“šè¼¸å…¥å€ -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold mb-3 text-gray-700">âš™ï¸ ç¶²æ ¼æ•¸æ“šè¼¸å…¥èˆ‡æ“ä½œ</h2>
                <textarea id="grid-input" rows="10" class="w-full p-2 border border-gray-300 rounded-lg text-sm font-mono focus:ring-blue-500 focus:border-blue-500"
                    placeholder="è¼¸å…¥æ–°çš„ç¶²æ ¼æ•¸æ“šï¼Œä¾‹å¦‚ï¼š\n[[7,4,9,6,7],[6,1,4,5,8],...] (ä½¿ç”¨ null è¡¨ç¤ºç©ºç™½)"></textarea>
                <div class="mt-3 space-y-2">
                    <button onclick="parseAndUpdateGrid()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                        æ›´æ–°ç¶²æ ¼ä¸¦é‡æ–°æ±‚è§£
                    </button>
                    <!-- æ–°å¢çš„éš¨æ©Ÿé—œå¡æŒ‰éˆ• -->
                    <button onclick="generateAndStartRandomGame()" class="w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/24/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2c1.773-1.01 4.54-1.229 6.273.738C12 18 17 21 20 18z"></path></svg>
                        <span>ç”Ÿæˆéš¨æ©Ÿæ–°é—œå¡</span>
                    </button>
                    
                    <!-- è‡ªå‹•åŸ·è¡ŒæŒ‰éˆ• (åŸ·è¡Œå‚³çµ±çš„ç›´ç·šæ¶ˆé™¤) -->
                    <button id="auto-button" onclick="autoEliminateNextMove()" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/24/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        <span>åŸ·è¡Œæœ€ä½³ç›´ç·šæ¶ˆé™¤ (ä¸‹ä¸€æ­¥)</span>
                    </button>
                    <!-- æ¸…é™¤é¸å–æŒ‰éˆ• -->
                    <button onclick="resetSelection()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                        æ¸…é™¤é¸å–
                    </button>
                    <!-- æ–°å¢çš„é‡æ–°é–‹å§‹æŒ‰éˆ• -->
                    <button onclick="restartGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                        é‡æ–°é–‹å§‹ (ç›¸åŒé—œå¡)
                    </button>
                </div>
                <p id="feedback-message" class="text-sm mt-2 text-center text-gray-500 hidden"></p>
            </div>

            <!-- çµæœæ‘˜è¦ (åªä¿ç•™åˆ†æ•¸å’Œé¡è‰²èªªæ˜) -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <!-- ã€ä¿®æ”¹é» 1ã€‘åªä¿ç•™åˆ†æ•¸é¡¯ç¤º -->
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xl font-semibold text-gray-700">å¾—åˆ†ç¸½è¨ˆ</h2>
                    <div class="text-lg font-bold text-red-600 bg-red-100 p-2 rounded-lg shadow-inner border border-red-200">
                        å·²æ¶ˆé™¤æ ¼å­ç¸½æ•¸: <span id="elimination-counter" class="ml-1">0</span> å€‹
                    </div>
                </div>
                <!-- ã€ä¿®æ”¹é» 1ã€‘ç§»é™¤ solution-summary å€å¡Š -->
                
                <div class="mt-4 pt-4 border-t border-gray-200 text-xs space-y-1">
                    <p class="font-bold text-gray-700">é¡è‰²ä»£ç¢¼ (åƒ…ç”¨æ–¼ç›´ç·šé«˜äº®è§£)</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-red-400"></span> **ç´…è‰² (1+9)**</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-green-400"></span> **ç¶ è‰² (2+8)**</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-yellow-300"></span> **é»ƒè‰² (3+7)**</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-blue-400"></span> **è—è‰² (4+6)**</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-rose-400"></span> **ç²‰ç´…è‰² (5+5)**</p>
                    <p><span class="inline-block w-3 h-3 rounded-full bg-violet-400"></span> **ç´«è‰² (å¤šä½æ•¸/å…¶ä»–)**</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // =========================================================
    // ã€æ–°å¢ã€‘éŸ³æ•ˆæ§åˆ¶é‚è¼¯
    // =========================================================

    // å®šç¾©æ‰€æœ‰éŸ³æ•ˆçš„é †åºå’Œ ID çµæ§‹
    const SOUND_SEQUENCE = [
        { id: 'sound1', name: 'æ­£äº‹ä¸å¹¹å°ˆæé€™ç¨®é³¥æ˜¯' },
        { id: 'sound2', name: 'æˆ‘å·²ç¶“å¾ˆèˆˆå¥®äº†' },
        { id: 'sound3', name: 'å°±æ˜¯é€™éº¼ç°¡å–®' },
        { id: 'sound4', name: 'ä¸Šå¸å°±è¦é™è‡¨å•¦' },
        { id: 'sound5', name: 'è¦‹è­‰äº†ç¥è¹Ÿå•¦' },
        { id: 'sound6', name: 'ç¥å¨è“‹ä¸–' }
    ];

    let currentSoundIndex = 0; // è¿½è¹¤ç•¶å‰æ’­æ”¾åˆ°å“ªå€‹éŸ³æ•ˆ
    
    /**
     * æ’­æ”¾ä¸‹ä¸€å€‹éŸ³æ•ˆä¸¦æ›´æ–°ç´¢å¼• (è¼ªæ’­æ’­æ”¾)
     */
    function playNextSound() {
        // ç²å–ç•¶å‰éŸ³æ•ˆçš„ ID å’Œåç¨±
        const currentSoundData = SOUND_SEQUENCE[currentSoundIndex];
        const currentSoundElement = document.getElementById(currentSoundData.id);

        // ç¢ºä¿æ¯æ¬¡æ’­æ”¾éƒ½å¾éŸ³æª”é–‹é ­æ’­æ”¾
        if (currentSoundElement) {
            currentSoundElement.currentTime = 0; 
            
            // æ’­æ”¾éŸ³æ•ˆ
            currentSoundElement.play()
                .catch(error => {
                    // ç€è¦½å™¨å¯èƒ½é˜»æ­¢è‡ªå‹•æ’­æ”¾ï¼Œä½†æ‰‹å‹•é»æ“Šå¾Œæ‡‰å…è¨±
                    console.warn(`éŸ³æ•ˆæ’­æ”¾å¤±æ•— (${currentSoundData.name}):`, error);
                });

            // æº–å‚™ä¸‹ä¸€å€‹ç´¢å¼• (å¾ªç’°)
            currentSoundIndex = (currentSoundIndex + 1) % SOUND_SEQUENCE.length; 
        }
    }


    // å®šç¾©æœ€å¤§é¸å–æ•¸é‡ (ä¸å†åš´æ ¼é™åˆ¶ï¼Œä½†ä¿ç•™è®Šæ•¸)
    const MAX_SELECTION = 10;
    const GRID_ROWS = 10;
    const GRID_COLS = 17;

    // æ ¹æ“šä½¿ç”¨è€…åœ–ç‰‡ (image_665c79.jpg) è½‰éŒ„çš„ 10x17 è¬é¡Œæ•¸æ“š
    const initialRawData = [
        [9, 3, 9, 4, 1, 7, 6, 7, 4, 8, 6, 8, 8, 8, 7, 4, 2],
        [4, 8, 4, 2, 2, 5, 7, 4, 7, 9, 3, 9, 5, 8, 7, 3, 4],
        [4, 4, 3, 2, 9, 5, 4, 6, 9, 4, 7, 2, 3, 4, 3, 2, 6],
        [3, 5, 8, 7, 1, 9, 5, 7, 8, 9, 5, 9, 7, 5, 5, 4, 2],
        [7, 5, 1, 6, 6, 3, 7, 2, 1, 2, 1, 4, 9, 4, 9, 9, 8],
        [1, 6, 5, 8, 6, 4, 9, 1, 2, 5, 3, 6, 1, 4, 8, 6, 7],
        [2, 3, 3, 6, 3, 1, 2, 4, 2, 4, 6, 7, 9, 8, 9, 1, 4],
        [7, 3, 1, 7, 3, 2, 7, 6, 8, 6, 1, 5, 2, 5, 6, 8, 3],
        [5, 5, 5, 1, 9, 5, 2, 3, 9, 4, 4, 8, 4, 2, 9, 5, 2],
        [9, 4, 2, 2, 1, 1, 5, 1, 7, 2, 9, 4, 1, 7, 7, 6, 6]
    ];

    let currentGrid = [];     // ç•¶å‰éŠæˆ²ç‹€æ…‹çš„ç¶²æ ¼ (æœƒè¢«æ¶ˆé™¤)
    let gameSeedGrid = [];    // ç•¶å‰é—œå¡çš„åˆå§‹ç¶²æ ¼ (ç”¨æ–¼é‡æ–°é–‹å§‹)
    let startCell = null;     // {r, c, element}
    let isDragging = false;
    
    let totalCellsEliminated = 0;

    const inputArea = document.getElementById('grid-input');
    const gridContainer = document.getElementById('puzzle-grid');
    // const summaryElement = document.getElementById('solution-summary'); // ã€ä¿®æ”¹é» 1ã€‘ç§»é™¤
    // const solutionCountElement = document.getElementById('solution-count'); // ã€ä¿®æ”¹é» 1ã€‘ç§»é™¤
    const feedbackMessage = document.getElementById('feedback-message');
    const autoButton = document.getElementById('auto-button');
    const clickFeedback = document.getElementById('click-feedback');
    const eliminationCounterElement = document.getElementById('elimination-counter'); 

    // Auto-solver only checks 2 directions: H (Right) and V (Down)
    const DIRECTIONS = [
        [0, 1],  // H: å³
        [1, 0]   // V: ä¸‹
    ];

    /**
     * æ ¹æ“šè§£æ±ºæ–¹æ¡ˆçš„é¡å‹ç²å–å„ªå…ˆç´šå€¼ (æ•¸å­—è¶Šå°ï¼Œå„ªå…ˆç´šè¶Šé«˜)
     */
    function getPriorityValue(type) {
        if (type === 'P_19') return 1; // 1 + 9 (æœ€é«˜å„ªå…ˆ)
        if (type === 'P_28') return 2; // 2 + 8 
        if (type === 'P_37') return 3; // 3 + 7
        if (type === 'P_46') return 4; // 4 + 6
        if (type === 'P_55') return 5; // 5 + 5
        if (type === 'P_Multi') return 6; // å¤šä½æ•¸çµ„åˆ (æœ€ä½å„ªå…ˆ)
        return 99; 
    }

    /**
     * *** èˆŠé‚è¼¯ï¼Œåƒ…ç”¨æ–¼è‡ªå‹•æ±‚è§£å™¨çš„é«˜äº®é¡¯ç¤º ***
     * æ ¸å¿ƒé‚è¼¯ï¼šæƒæç¶²æ ¼æ‰¾å‡ºæ‰€æœ‰ç›¸åŠ ç­‰æ–¼ 10 çš„ç›¸é„°çµ„åˆ (å¯è·³éç©ºç™½)
     */
    function findSolutions(grid) {
        if (!grid || grid.length === 0) return { solutions: [], solutionCoords: new Set(), cellPriorityMap: new Map() };

        const R = grid.length;
        const C = grid[0].length;
        const solutions = []; 
        const cellPriorityMap = new Map(); 

        for (let r = 0; r < R; r++) {
            for (let c = 0; c < C; c++) {
                if (grid[r][c] === null) continue; 

                DIRECTIONS.forEach(([dr, dc]) => {
                    let currentSum = grid[r][c];
                    let coords = [`${r}_${c}`];
                    let values = [grid[r][c]];
                    
                    let nr = r + dr;
                    let nc = c + dc;

                    // æª¢æŸ¥ç›´ç·šæ–¹å‘
                    while (nr >= 0 && nr < R && nc >= 0 && nc < C && coords.length < MAX_SELECTION) {
                        const value = grid[nr][nc];
                        
                        if (value !== null) {
                            // æ‰¾åˆ°éç©ºæ•¸å­—ï¼ŒåŠ å…¥ç¸½å’Œ
                            currentSum += value;
                            coords.push(`${nr}_${nc}`); 
                            values.push(value);

                            if (currentSum === 10 && coords.length >= 2) {
                                // --- Solution Found ---
                                let type;
                                let description;
                                if (coords.length === 2) {
                                    const sortedValues = [...values].sort((a, b) => a - b);
                                    const v1 = sortedValues[0];
                                    const v2 = sortedValues[1];
                                    
                                    if (v1 === 1 && v2 === 9) { type = 'P_19'; description = `(1+9 ç´…è‰²)`; } 
                                    else if (v1 === 2 && v2 === 8) { type = 'P_28'; description = `(2+8 ç¶ è‰²)`; } 
                                    else if (v1 === 3 && v2 === 7) { type = 'P_37'; description = `(3+7 é»ƒè‰²)`; } 
                                    else if (v1 === 4 && v2 === 6) { type = 'P_46'; description = `(4+6 è—è‰²)`; } 
                                    else if (v1 === 5 && v2 === 5) { type = 'P_55'; description = `(5+5 ç²‰ç´…è‰²)`; } 
                                    else { type = 'P_Multi'; description = `(å…¶ä»–å¤šä½æ•¸/æ„å¤– - ç´«è‰²)`; }
                                } else { 
                                    type = 'P_Multi';
                                    description = `(å¤šä½æ•¸çµ„åˆ - ç´«è‰²)`;
                                }

                                solutions.push({
                                    coords: [...coords],
                                    value: values.join(' + ') + ` = 10`,
                                    type: type,
                                    description: description
                                });
                                
                                // æ‰¾åˆ°ä¸€çµ„è§£å¾Œï¼Œåœæ­¢æ­¤æ–¹å‘çš„æœç´¢
                                break; 
                            } else if (currentSum > 10) {
                                // è¶…é 10ï¼Œåœæ­¢æ­¤æ–¹å‘çš„æœç´¢
                                break; 
                            }
                        }
                        
                        // ç¹¼çºŒæª¢æŸ¥ä¸‹ä¸€å€‹å–®å…ƒæ ¼ (å³ä½¿ç•¶å‰æ˜¯ nullï¼Œä¹Ÿæœƒè·³éä¸¦ç¹¼çºŒå‰é€²)
                        nr += dr;
                        nc += dc;
                    }
                });
            }
        }
        
        // --- Post-processing: Build the Priority Map ---
        // ç¢ºä¿æ¯å€‹å–®å…ƒæ ¼è¢«å…¶æœ€é«˜å„ªå…ˆç´šçš„è§£é«˜äº®
        solutions.forEach(sol => {
            const currentPriority = getPriorityValue(sol.type);
            sol.coords.forEach(coord => {
                const existingType = cellPriorityMap.get(coord);
                const existingPriority = existingType ? getPriorityValue(existingType) : 100;

                if (currentPriority < existingPriority) {
                    cellPriorityMap.set(coord, sol.type);
                }
            });
        });

        solutions.sort((a, b) => getPriorityValue(a.type) - getPriorityValue(b.type));

        return { solutions, solutionCoords: new Set(cellPriorityMap.keys()), cellPriorityMap };
    }
    
    /**
     * *** æ–°é‚è¼¯ï¼šè¨ˆç®—çŸ©å½¢å€åŸŸå…§çš„å…§å®¹ ***
     * å°‹æ‰¾å¾ start åˆ° end çš„çŸ©å½¢è·¯å¾‘ä¸Šçš„æ‰€æœ‰éç©ºæ•¸å­—
     */
    function findRectangleContents(startR, startC, endR, endC) {
        const R = currentGrid.length;
        const C = currentGrid[0].length;
        
        // Determine the boundaries of the rectangle
        const minR = Math.min(startR, endR);
        const maxR = Math.max(startR, endR);
        const minC = Math.min(startC, endC);
        const maxC = Math.max(startC, endC);

        let coords = [];
        let values = [];
        let sum = 0;

        // Iterate through the rectangle
        for (let r = minR; r <= maxR; r++) {
            for (let c = minC; c <= maxC; c++) {
                const value = currentGrid[r][c];

                // Only count non-null (non-eliminated) cells
                if (value !== null) {
                    sum += value;
                    coords.push({r, c});
                    values.push(value);
                }
            }
        }

        // å¿…é ˆè‡³å°‘åŒ…å« 2 å€‹éç©ºæ•¸å­—æ‰èƒ½æ§‹æˆæ¶ˆé™¤
        const isValid = coords.length >= 2; 

        return { 
            isValid: isValid, 
            coords: coords, 
            values: values, 
            sum: sum 
        };
    }


    /**
     * é‡è¨­æ»‘é¼ é¸å–ç‹€æ…‹ (æ¸…é™¤é è¦½)
     */
    function resetSelection(message = `è«‹æ‹–æ›³é¸å–èµ·é»å’Œçµ‚é»ï¼Œå®šç¾©çŸ©å½¢å€åŸŸã€‚`, isError = false) {
        // æ¸…é™¤æ‰€æœ‰å–®å…ƒæ ¼çš„ selected-path æ¨£å¼
        document.querySelectorAll('.selected-path').forEach(el => {
            el.classList.remove('selected-path');
        });
        
        startCell = null;
        isDragging = false;
        
        clickFeedback.textContent = message;
        clickFeedback.className = `mt-4 text-center font-medium text-lg ${isError ? 'text-red-600' : 'text-blue-600'}`;
    }

    /**
     * è™•ç†æ»‘é¼ æ”¾é–‹ (mouseup / pointerup) äº‹ä»¶ï¼šé©—è­‰çŸ©å½¢é¸å–ä¸¦åŸ·è¡Œæ¶ˆé™¤
     */
    function handleMouseUp(event) {
        if (!isDragging || !startCell) {
            isDragging = false;
            return;
        }
        
        const endCellElement = event.target.closest('.puzzle-cell');
        if (!endCellElement) {
            // åœ¨ç¶²æ ¼å¤–æ”¾é–‹
            resetSelection();
            return;
        }
        
        const endR = parseInt(endCellElement.dataset.r, 10);
        const endC = parseInt(endCellElement.dataset.c, 10);

        // çŸ©å½¢é¸å–é‚è¼¯
        const path = findRectangleContents(startCell.r, startCell.c, endR, endC);

        if (!path.isValid) {
            resetSelection('âŒ ç„¡æ•ˆçš„çŸ©å½¢é¸å–ï¼é¸å–å€åŸŸå…§å¿…é ˆè‡³å°‘åŒ…å« 2 å€‹éç©ºæ•¸å­—ã€‚', true);
            return;
        }
        
        const sum = path.sum;

        if (sum > 10) {
            resetSelection(`âŒ çŸ©å½¢å…§æ‰€æœ‰æ•¸å­—ç¸½å’Œ (${sum}) è¶…é 10ã€‚è«‹é‡æ–°é¸å–ã€‚`, true);
            return;
        }
        
        if (sum === 10) {
            // æˆåŠŸæ¶ˆé™¤
            executeManualElimination(path.coords, sum);
            return;
        }

        // æç¤ºç•¶å‰çŸ©å½¢çš„ç¸½å’Œ
        resetSelection(`âš ï¸ çŸ©å½¢é¸å–æˆåŠŸï¼Œä½†ç¸½å’Œç‚º ${sum}ã€‚ç›®æ¨™æ˜¯ 10ã€‚`, true);
    }
    
    /**
     * è™•ç†æ»‘é¼ ç§»å‹• (mousemove / pointermove) äº‹ä»¶ï¼šé è¦½çŸ©å½¢é¸å–è·¯å¾‘
     * ä¿®æ­£ï¼šç¾åœ¨æœƒé«˜äº®é¡¯ç¤ºæ•´å€‹æ‹–æ›³çš„çŸ©å½¢é‚Šç•Œï¼ŒåŒ…æ‹¬ç©ºå–®å…ƒæ ¼ã€‚
     */
    function handleMouseMove(event) {
        if (!isDragging || !startCell) return;
        
        const currentCellElement = event.target.closest('.puzzle-cell');
        if (!currentCellElement) return;

        const currentR = parseInt(currentCellElement.dataset.r, 10);
        const currentC = parseInt(currentCellElement.dataset.c, 10);
        
        // 1. ç¢ºå®šçŸ©å½¢çš„é‚Šç•Œ
        const minR = Math.min(startCell.r, currentR);
        const maxR = Math.max(startCell.r, currentR);
        const minC = Math.min(startCell.c, currentC);
        const maxC = Math.max(startCell.c, currentC);

        // 2. æ¸…é™¤èˆŠçš„é è¦½
        document.querySelectorAll('.selected-path').forEach(el => {
            el.classList.remove('selected-path');
        });

        // 3. å°‹æ‰¾æ–°çš„çŸ©å½¢å…§å®¹ (Non-null cells) ä»¥è¨ˆç®—ç¸½å’Œ
        const path = findRectangleContents(startCell.r, startCell.c, currentR, currentC);

        // 4. æ¸²æŸ“æ•´å€‹çŸ©å½¢é‚Šç•Œ
        for (let r = minR; r <= maxR; r++) {
            for (let c = minC; c <= maxC; c++) {
                const element = document.querySelector(`.puzzle-cell[data-r="${r}"][data-c="${c}"]`);
                if (element) {
                    element.classList.add('selected-path');
                }
            }
        }

        // 5. æ¸²æŸ“æç¤º (ä½¿ç”¨éç©ºæ•¸å­—çš„ç¸½å’Œ)
        if (path.coords.length > 0) {
            const sum = path.sum;
            
            if (path.coords.length < 2) {
                 clickFeedback.textContent = 'â›” é¸å–å€åŸŸå…§è‡³å°‘éœ€è¦ 2 å€‹éç©ºæ•¸å­—ã€‚';
                 clickFeedback.className = `mt-4 text-center font-medium text-lg text-red-600`;
            } else if (sum > 10) {
                clickFeedback.textContent = `âŒ çŸ©å½¢å…§æ‰€æœ‰æ•¸å­—ç¸½å’Œ (${sum}) è¶…é 10ã€‚`;
                clickFeedback.className = `mt-4 text-center font-medium text-lg text-red-600`;
            } else {
                clickFeedback.textContent = `çŸ©å½¢å·²é¸å– ${path.coords.length} å€‹æ•¸å­—ï¼Œç¸½å’Œç‚º ${sum}ã€‚ç›®æ¨™æ˜¯ 10ã€‚`;
                clickFeedback.className = `mt-4 text-center font-medium text-lg ${sum === 10 ? 'text-green-600' : 'text-yellow-600'}`;
            }
        } else {
            clickFeedback.textContent = 'â›” æ‹–æ›³å€åŸŸå…§æ²’æœ‰å¯é¸å–çš„æ•¸å­—ã€‚';
            clickFeedback.className = `mt-4 text-center font-medium text-lg text-red-600`;
        }
    }

    /**
     * è™•ç†æ»‘é¼ æŒ‰ä¸‹ (mousedown / pointerdown) äº‹ä»¶ï¼šè¨­ç½®èµ·é»
     */
    function handleMouseDown(event) {
        const cellElement = event.target.closest('.puzzle-cell');
        if (!cellElement) return;

        const r = parseInt(cellElement.dataset.r, 10);
        const c = parseInt(cellElement.dataset.c, 10);
        
        if (currentGrid[r][c] === null) {
            resetSelection('â›” å·²æ¶ˆé™¤çš„å–®å…ƒæ ¼ä¸èƒ½ä½œç‚ºçŸ©å½¢æ¡†é¸çš„èµ·é»ã€‚', true);
            return;
        }

        // æ¸…é™¤ä¸Šä¸€æ¬¡çš„é è¦½å’ŒéŒ¯èª¤
        resetSelection(); 

        isDragging = true;
        startCell = { r, c, element: cellElement };
        
        // ç‚ºäº†è®“å–®å€‹ cell ä¹Ÿèƒ½æœ‰ pre-select æ¨£å¼
        cellElement.classList.add('selected-path'); 
    }
    
    /**
     * åŸ·è¡Œæ‰‹å‹•æ¶ˆé™¤æ­¥é©Ÿ
     */
    function executeManualElimination(coords, sum) {
        // åŸ·è¡Œæ¶ˆé™¤ï¼šå°‡ç¶²æ ¼ä¸­çš„é€™äº›åº§æ¨™è¨­ç‚º null
        coords.forEach(coord => {
            currentGrid[coord.r][coord.c] = null;
        });
        
        // ã€éŸ³æ•ˆæ•´åˆé» 1: æ‰‹å‹•æ¶ˆé™¤ã€‘
        playNextSound();

        resetSelection(`ğŸ‰ æˆåŠŸæ¶ˆé™¤ï¼çŸ©å½¢ç¸½å’Œ (${sum})ã€‚è«‹æ‹–æ›³é¸å–ä¸‹ä¸€çµ„ã€‚`, false);
        
        // é‡æ–°æ±‚è§£ä¸¦æ¸²æŸ“
        reSolveAndRender();

        totalCellsEliminated += coords.length;
        updateTotalCellsEliminatedDisplay();
        
        // æç¤ºè³‡è¨Š
        feedbackMessage.classList.remove('hidden');
        feedbackMessage.textContent = `âœ… æ‰‹å‹•çŸ©å½¢æ¶ˆé™¤æˆåŠŸï¼šç¸½å…±æ¸…é™¤äº† ${coords.length} å€‹æ ¼å­ã€‚`;
    }

    /**
     * æ›´æ–°æ¶ˆé™¤ç¸½æ ¼å­æ•¸é‡çš„é¡¯ç¤º
     */
    function updateTotalCellsEliminatedDisplay() {
        if (eliminationCounterElement) {
            eliminationCounterElement.textContent = totalCellsEliminated;
        }
    }


    /**
     * æ¸²æŸ“ç¶²æ ¼ä¸¦é«˜äº®è§£
     */
    function renderGrid(grid, solutionCoords = new Set(), cellPriorityMap = new Map()) {
        gridContainer.innerHTML = ''; 

        if (!grid || grid.length === 0) {
            gridContainer.innerHTML = '<p class="text-red-500">ç¶²æ ¼æ•¸æ“šç„¡æ•ˆæˆ–ç‚ºç©ºã€‚</p>';
            autoButton.disabled = true;
            return;
        }

        autoButton.disabled = false;
        grid.forEach((row, r) => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'flex';
            row.forEach((cellValue, c) => {
                const coord = `${r}_${c}`;
                const cellDiv = document.createElement('div');
                
                cellDiv.dataset.r = r;
                cellDiv.dataset.c = c;
                
                if (cellValue === null) {
                    cellDiv.textContent = '';
                    cellDiv.className = `puzzle-cell cleared-cell`;
                } else {
                    cellDiv.textContent = cellValue;
                    
                    // é€™è£¡ä½¿ç”¨ç›´ç·šæ±‚è§£å™¨çš„çµæœä¾†æ±ºå®šé¡è‰²
                    const highestPriorityType = cellPriorityMap.get(coord);
                    let colorClass = 'default-cell'; 
                    
                    if (highestPriorityType === 'P_19') colorClass = 'highlight-19';
                    else if (highestPriorityType === 'P_28') colorClass = 'highlight-28';
                    else if (highestPriorityType === 'P_37') colorClass = 'highlight-37';
                    else if (highestPriorityType === 'P_46') colorClass = 'highlight-46';
                    else if (highestPriorityType === 'P_55') colorClass = 'highlight-55';
                    else if (highestPriorityType === 'P_Multi') colorClass = 'highlight-multi';


                    cellDiv.className = `puzzle-cell ${colorClass}`;
                }
                
                rowDiv.appendChild(cellDiv);
            });
            gridContainer.appendChild(rowDiv);
        });
        
        attachDragListeners();
    }

    /**
     * é™„åŠ æ‹–æ›³äº‹ä»¶ç›£è½å™¨ (æ”¹ç”¨ pointer äº‹ä»¶ï¼Œæ”¯æ´è§¸æ§)
     */
    function attachDragListeners() {
        // ç§»é™¤å¯èƒ½å­˜åœ¨çš„ pointer äº‹ä»¶ï¼Œç¢ºä¿ä¸é‡è¤‡ç¶å®š
        gridContainer.removeEventListener('pointerdown', pointerDownHandler);
        gridContainer.removeEventListener('pointermove', pointerMoveHandler);
        document.removeEventListener('pointerup', pointerUpHandler);
        
        gridContainer.addEventListener('pointerdown', pointerDownHandler, { passive: false });
        gridContainer.addEventListener('pointermove', pointerMoveHandler, { passive: false });
        document.addEventListener('pointerup', pointerUpHandler);
    }

    // wrapper handlers to allow preventDefault + unified pointer events
    function pointerDownHandler(e) { e.preventDefault(); handleMouseDown(e); }
    function pointerMoveHandler(e) { e.preventDefault(); handleMouseMove(e); }
    function pointerUpHandler(e) { handleMouseUp(e); }


    /**
     * æ¸²æŸ“çµæœæ‘˜è¦ (å·²ç§»é™¤ï¼Œåƒ…ä¿ç•™æ­¤ç©ºå‡½æ•¸ä»¥ç¶­æŒèª¿ç”¨çµæ§‹)
     */
    function renderSummary(solutions) {
        // ã€ä¿®æ”¹é» 1ã€‘æ­¤å‡½æ•¸ç¾åœ¨åƒ…æª¢æŸ¥è‡ªå‹•æ±‚è§£å™¨çš„å¯è¡Œæ€§
        // solutionCountElement.textContent = solutions.length; // ç§»é™¤
        // summaryElement.innerHTML = ''; // ç§»é™¤
        
        if (solutions.length === 0) {
            // summaryElement.innerHTML = '<p class="text-green-600 font-medium">å¤ªæ£’äº†ï¼ç›®å‰ç¶²æ ¼ä¸­å·²ç„¡å¯æ¶ˆé™¤çš„ç›´ç·šçµ„åˆã€‚</p>'; // ç§»é™¤
            autoButton.disabled = true;
            return;
        }
        
        autoButton.disabled = false;
        // ç§»é™¤æ‰€æœ‰é—œæ–¼åˆ—è¡¨æ¸²æŸ“çš„ä»£ç¢¼
    }
    
    /**
     * é‡æ–°æ±‚è§£ä¸¦æ¸²æŸ“ç¶²æ ¼å’Œæ‘˜è¦
     */
    function reSolveAndRender() {
        // é€™è£¡çš„ findSolutions ä»èˆŠä½¿ç”¨èˆŠçš„ç›´ç·šé‚è¼¯ä¾†è¨ˆç®—é¡è‰²å’Œåˆ—è¡¨
        const { solutions, solutionCoords, cellPriorityMap } = findSolutions(currentGrid);
        renderGrid(currentGrid, solutionCoords, cellPriorityMap);
        
        // å°‡ç•¶å‰çš„ "ç¨®å­ç¶²æ ¼" ç‹€æ…‹å¯«å…¥è¼¸å…¥æ¡†ï¼Œé€™æ¨£ä½¿ç”¨è€…å¯ä»¥è¤‡è£½é€™å€‹é—œå¡
        inputArea.value = JSON.stringify(gameSeedGrid, null, 2);

        renderSummary(solutions);
    }

    /**
     * è¨­ç½®æ–°çš„ç¶²æ ¼æ•¸æ“šä¸¦é‡æ–°é–‹å§‹éŠæˆ²æµç¨‹
     */
    function setNewGridData(newGridData, message) {
        // 1. å°‡æ–°çš„ç¶²æ ¼æ•¸æ“šè¨­ç‚ºç•¶å‰çš„ 'ç¨®å­' ç¶²æ ¼ (æ·±å±¤è¤‡è£½)
        gameSeedGrid = newGridData.map(row => [...row]); 
        currentGrid = newGridData.map(row => [...row]); // 2. è¨­å®šå·¥ä½œç¶²æ ¼

        // 3. é‡è¨­åˆ†æ•¸
        totalCellsEliminated = 0;
        updateTotalCellsEliminatedDisplay();
        
        // 4. æ¸…é™¤é¸å–å’ŒéŒ¯èª¤è¨Šæ¯
        resetSelection(message, false);
        feedbackMessage.classList.add('hidden');

        // 5. é‡æ–°æ¸²æŸ“å’Œæ±‚è§£
        reSolveAndRender();

        // 6. æ»¾å‹•åˆ°ç¶²æ ¼
        gridContainer.scrollIntoView({ behavior: 'smooth' });
    }

    /**
     * è™•ç†ç¶²æ ¼æ›´æ–°çš„å‡½æ•¸ (å¾è¼¸å…¥æ¡†è§£ææ•¸æ“š)
     */
    function parseAndUpdateGrid() {
        let newGrid;
        try {
            newGrid = JSON.parse(inputArea.value.trim());
            if (!Array.isArray(newGrid) || newGrid.length === 0 || !Array.isArray(newGrid[0])) {
                throw new Error("æ•¸æ“šæ ¼å¼éŒ¯èª¤ï¼Œæ‡‰ç‚ºäºŒç¶­é™£åˆ—ã€‚");
            }
        } catch (e) {
            feedbackMessage.textContent = `æ•¸æ“šè§£æéŒ¯èª¤ï¼è«‹ç¢ºä¿æ‚¨è¼¸å…¥çš„æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼çš„äºŒç¶­é™£åˆ— (e.g., [[1,2], [3,4]]). éŒ¯èª¤: ${e.message}`;
            feedbackMessage.classList.remove('hidden');
            feedbackMessage.classList.remove('text-gray-500');
            feedbackMessage.classList.add('text-red-500');
            return;
        }
        
        // æˆåŠŸè§£æå¾Œï¼Œå°‡æ–°çš„ç¶²æ ¼è¨­ç‚ºç•¶å‰çš„éŠæˆ²ç¨®å­
        setNewGridData(newGrid, 'ç¶²æ ¼å·²æ›´æ–°ï¼Œè«‹é–‹å§‹æ–°çš„çŸ©å½¢æ¡†é¸ã€‚');
    }
    
    /**
     * ç”Ÿæˆä¸€å€‹æŒ‡å®šå¤§å°çš„éš¨æ©Ÿç¶²æ ¼ (æ•¸å­—ç¯„åœ 1-9)
     */
    function generateRandomGrid(rows, cols) {
        const newGrid = [];
        for (let r = 0; r < rows; r++) {
            const row = [];
            for (let c = 0; c < cols; c++) {
                // ç”¢ç”Ÿ 1 åˆ° 9 çš„éš¨æ©Ÿæ•´æ•¸
                row.push(Math.floor(Math.random() * 9) + 1); 
            }
            newGrid.push(row);
        }
        return newGrid;
    }

    /**
     * ç”¢ç”Ÿä¸¦é–‹å§‹ä¸€å€‹æ–°çš„éš¨æ©ŸéŠæˆ²
     */
    function generateAndStartRandomGame() {
        const newRandomGrid = generateRandomGrid(GRID_ROWS, GRID_COLS);
        setNewGridData(newRandomGrid, 'ğŸ‰ å·²ç”Ÿæˆæ–°çš„éš¨æ©Ÿé—œå¡ï¼è«‹é–‹å§‹çŸ©å½¢æ¡†é¸ã€‚');
    }

    /**
     * é‡æ–°é–‹å§‹éŠæˆ² (å¾ç•¶å‰é—œå¡çš„ç¨®å­æ•¸æ“šé‡æ–°åŠ è¼‰)
     */
    function restartGame() {
        // ä½¿ç”¨ gameSeedGrid é€²è¡Œé‡å•Ÿ
        setNewGridData(gameSeedGrid, 'éŠæˆ²å·²é‡è¨­ï¼Œå¾ç•¶å‰é—œå¡é‡æ–°é–‹å§‹ï¼');
    }


    /**
     * è‡ªå‹•åŸ·è¡Œæœ€ä½³ä¸‹ä¸€æ­¥æ¶ˆé™¤ (ä»ä½¿ç”¨å‚³çµ±ç›´ç·šè¦å‰‡)
     */
    function autoEliminateNextMove() {
        const { solutions } = findSolutions(currentGrid);
        
        feedbackMessage.classList.remove('hidden');
        resetSelection('å·²ä½¿ç”¨è‡ªå‹•æ¨¡å¼ã€‚');
        
        if (solutions.length === 0) {
            feedbackMessage.textContent = 'â›” ç¶²æ ¼ä¸­å·²ç„¡å¯æ¶ˆé™¤çš„ç›´ç·šçµ„åˆï¼';
            autoButton.disabled = true;
            return;
        }
        
        const bestMove = solutions[0];
        
        // åŸ·è¡Œæ¶ˆé™¤ï¼šå°‡ç¶²æ ¼ä¸­çš„é€™äº›åº§æ¨™è¨­ç‚º null
        bestMove.coords.forEach(coordStr => {
            const [r, c] = coordStr.split('_').map(n => parseInt(n, 10));
            currentGrid[r][c] = null; 
        });
        
        // ã€éŸ³æ•ˆæ•´åˆé» 2: è‡ªå‹•æ¶ˆé™¤ã€‘
        playNextSound();

        reSolveAndRender();

        totalCellsEliminated += bestMove.coords.length;
        updateTotalCellsEliminatedDisplay();

        feedbackMessage.textContent = `âœ… æˆåŠŸåŸ·è¡Œäº†æœ€ä½³ç›´ç·šæ¶ˆé™¤ ( ${bestMove.description} )ï¼šæ¸…é™¤äº† ${bestMove.coords.length} å€‹æ ¼å­ã€‚`;

        gridContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    // é é¢åŠ è¼‰æ™‚åˆå§‹åŒ–
    window.onload = () => {
        // å°‡åˆå§‹é—œå¡å¡«å…¥è¼¸å…¥æ¡†ï¼Œä¸¦ä½¿ç”¨å›ºå®šçš„ initialRawData ä½œç‚ºç¨®å­
        inputArea.value = JSON.stringify(initialRawData, null, 2);
        setNewGridData(initialRawData, 'éŠæˆ²å·²é–‹å§‹ã€‚è«‹æ‹–æ›³é¸å–èµ·é»å’Œçµ‚é»ï¼Œå®šç¾©çŸ©å½¢å€åŸŸã€‚');
    };
</script>

<script>
// =========================================================
// ã€ä¿®æ”¹é» 2ã€‘éœæ…‹æ’è¡Œæ¦œæ•¸æ“šèˆ‡æ¸²æŸ“
// =========================================================

// æ‚¨å¯ä»¥åœ¨é€™è£¡æ‰‹å‹•ä¿®æ”¹æ’è¡Œæ¦œçš„åç¨±å’Œåˆ†æ•¸
const MANUAL_LEADERBOARD_DATA = [
    { name: 'ç¾…èª²é•·', score: 120 },
    { name: 'æ¹¯åœ“', score: 115 },
    { name: 'é™³å­¸å„€', score: 95 }
    // æ‚¨å¯ä»¥å¢åŠ æ›´å¤šé …ç›®ï¼Œä½†åªæœƒé¡¯ç¤ºå‰ä¸‰å
];

/**
 * æ¸²æŸ“æ‰‹å‹•è¼¸å…¥çš„æ’è¡Œæ¦œæ•¸æ“š
 */
function loadLeaderboard() {
    let lb = document.getElementById('leaderboard'); 
    lb.innerHTML = '';

    if (MANUAL_LEADERBOARD_DATA.length === 0) {
        lb.innerHTML = '<li>ç›®å‰æ²’æœ‰æ’è¡Œæ¦œæ•¸æ“šã€‚</li>';
        return;
    }
    
    // æ’åº (ç¢ºä¿å³ä½¿æ‚¨è¼¸å…¥é †åºäº‚äº†ï¼Œä¹ŸæœƒæŒ‰åˆ†æ•¸æ’åº)
    const sortedData = [...MANUAL_LEADERBOARD_DATA].sort((a, b) => b.score - a.score);

    // åªé¡¯ç¤ºå‰ä¸‰å
    sortedData.slice(0, 3).forEach((r, i) => { 
        lb.innerHTML += `<li class="p-1 bg-gray-50 rounded-md flex justify-between items-center">
            <span class="font-bold text-lg text-blue-600 mr-2">${i + 1}.</span> 
            <span class="flex-grow">${r.name}</span>
            <span class="font-mono text-red-500">${r.score} åˆ†</span>
        </li>`;
    });
}

// é é¢åŠ è¼‰æ™‚ï¼Œåœ¨éŠæˆ²åˆå§‹åŒ–ä¹‹å¾Œæ¸²æŸ“æ’è¡Œæ¦œ
window.addEventListener('load', () => {
    // è¨»é‡‹æ‰åŸæœ¬ä½¿ç”¨ localStorage çš„ä»£ç¢¼
    /* let playerName = localStorage.getItem('np-name')||'';
    if(!playerName) askName();
    */
    loadLeaderboard();
});

// ç§»é™¤åŸæœ¬çš„ updateLeaderboard å’Œ askName å‡½æ•¸ï¼Œå› ç‚ºç¾åœ¨æ˜¯æ‰‹å‹•è¼¸å…¥
/*
function updateLeaderboard(score){
    // ...
}
function askName(){
    // ...
}
*/
</script>
</body>
</html>